#!/usr/bin/python

import sys
from subprocess import PIPE
import subprocess

def main():
  project = sys.argv[1]
  ipRange = sys.argv[2]
  subprocess.call(['mkdir',sys.argv[1]])
  iplist = fping(ipRange);
  for ip in iplist:
    print ip
    tcpConnect(project, ip)
    break;
    

def fping(ipRange):
  # -a show only alive systems
  # -g generate a target list
  pro = subprocess.Popen(["fping","-ag", ipRange], stdout=PIPE, stderr=PIPE)
  return pro.communicate()[0].split()
  
def tcpConnect(project, ip):
  # -sT TCP Scan
  # -p- all ports, not just top 1K
  # -PN  skip host discovery
  log = open ((project +'/tcpConnect'),'a')
  log.write (ip)
  prog = subprocess.Popen(['nmap','-sT','-PN',ip],stdout=log, stderr=PIPE)
  prog.wait()
  log.close()
#'-p-',

if __name__ == "__main__":
  main()
